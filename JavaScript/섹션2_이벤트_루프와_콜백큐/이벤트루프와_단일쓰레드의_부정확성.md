# 이벤트루프와 단일쓰레드의 부정확성

## WEB APIs, Callback Queue, Event Loop

1. Call Stack에서 실행된 비동기 함수는 Web Api로 이동
2. Web Api에서 설정되어있는 시간만큼 기다리다가 Callback Queue로 이동
3. Callback Queue에서 Event Loop가 Call Stack이 비어져있을때 Queue에 가장 먼저 들어와 있는 함수부터 Call Stack 으로 옮겨 실행시킨다

### Event Loop

1. 안쉬나요?
   </br>안쉽니다
2. 콜스택이 바쁘면?

   - 대기상태에 빠지게 된다
     만약 아래와 같은 코드를 짠다면?
     setTimeout은 이미 끝나서 Callback queue에 들어가지만 Call Stack이 안비워져있기 때문에 Event Loop가 해당 함수를 Call Stack으로 넣을 수 없어 대기상태에 빠지게 된다.
   - 예정된 작업이 제때 동작하지 않는 오류가 발생할 수 있다
   - 그렇기 때문에 예정된 작업이 제때 동작하지 않을 수 있으므로 메인 스레드가 바쁘지 않게하는 방법을 고민해야 한다.

   ```javascript
   setTimeout(() => console.log("후순위"), 10);
   for (let i = 0; i < 1e10; i++) {}
   console.log("끝");
   ```

   - 위의 코드를 보고나서 반복문이 끝나고 난 뒤 Call Stack이 빈다면 console.log가 더 빠르게 실행될 지 아니면 Callback queue에 있는 함수를 Event Loop가 더 빠르게 옮겨 실행시킬 지 궁금해 찾아봤다
     - 그 결과 console.log가 더 빨리 실행되는데 그 이유는 Event Loop는 하나의 태스크 단위로 작동하기 때문에 비었다고 실행되는게 아니라 현재 한 Task가 완전히 끝나야 비어있는지 확인하기 때문이다
     -

3. Event Loop는 JS엔진에 있는가?
   Event Loop는 런타임환경에서 제공한다. 즉, 브라우저 또는 Node.js에서 제공
